---
title: "Visualizing the bayesian workflow in R"
author: "Nayef Ahmad"
date: "2022-03-21" 
output: 
   github_document: 
     toc: true
     number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Overview 

References: 

- [Blog post by Monica Alexander](https://www.monicaalexander.com/posts/2020-28-02-bayes_viz/)


# Libraries 

```{r}
library(tidyverse)
library(rstan)
library(brms)
library(bayesplot)
library(loo)
library(tidybayes)
library(here)
library(GGally)
```

# Reading in data 

```{r}
ds <- read_rds(here::here("data", "births_2017_sample.RDS"))

ds <- 
  ds %>% 
  rename(birthweight = dbwt, 
         gest = combgest) %>% 
  mutate(preterm = ifelse(gest < 32, "Y", "N")) %>% 
  filter(ilive == "Y", 
         gest < 99, 
         birthweight < 9.999)

str(ds)
summary(ds)
head(ds)
```

## Explanation of variables: 

1. `gest` is gestational age in weeks. 40 weeks is considered normal. 
1. `birthweight` is birth weight in kilograms (?). 
1. `preterm` is a binary variable identifying births before 32 weeks. 


# EDA 

## Log transformation 

In the original post, modeling is done on the log scale. However, it's not totally clear to me that the log transformation yields a better fit. 

```{r}
ds %>% 
  ggplot(aes(x = gest, y = birthweight)) + 
  geom_point(alpha = .3) + 
  geom_smooth() + 
  geom_smooth(method = "lm", col = "red") + 
  labs(title = "birthweight vs gestational age")


```

```{r}
ds %>% 
  ggplot(aes(x = log(gest), y = log(birthweight))) + 
  geom_point(alpha = .3) + 
  geom_smooth() + 
  geom_smooth(method = "lm", col = "red") + 
  labs(title = "log(birthweight) vs log(gestational age)")


```

## Interaction between gestational age and preterm 

```{r}
ggpairs(ds[,c("birthweight", "gest", "preterm")])
```



